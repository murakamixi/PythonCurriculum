## 概要

多項式回帰というものについて学習します。ここでは定義を軽く示しますが、高校数学の範囲を逸脱するものも含まれています。ですので、ここではあくまで使えるようになるのが目標です。理解するのはしばらく取っておきましょう。

# この章の目標

**推定完了時間: １時間30分**

　ここまで、単回帰分析と重回帰分析を学んできました。このモデルは直線を引くという点で直感的でわかりやすいというメリットがあります。ですが、直線で全てが近似できるわけではありません。曲線の方が多くの場合に最適にデータに近似している線がかけるでしょう。その書き方を学んでいきましょう。

**1. 多項式回帰の手法を学習しよう**

# 多項式回帰分析とは

　回帰分析のような直線で世の中を全て近似できたら楽なことはありません。ですが、現実はもっと複雑だとみんな知っています。そんな複雑で1次関数(単・重回帰分析)で直線的な関係が、すなわちyとxに一次関数的な関係が見られない時は多項式回帰が有効な手段です。
　多項式回帰では2次関数や3次関数のような、次数の高い曲線的な分布のデータの予測を行うことが出来ます。多項式回帰の一般式は以下に示されます。理解する必要はありません。
　ここでの**最優先目標は多項式回帰を使えることになること**です。理論は後からで構いません。

$$\displaystyle y=\sum_{i=0}^{n}\beta_ix^i$$
$$\beta = パラメータ｜n = 次数$$

## 用いるデータを確認しよう

　まず、用いるデータの確認をしましょう。データは**目的変数['target']**と**説明変数['LSTAT','RM']**を用いて多項式回帰を行っていきます。

　重回帰分析と同じ変数を用いるので、どのように変化するかもみてみましょう。

## 重回帰分析を行おう

　重回帰分析のコードを別のコードブロックへコピーしてから進めましょう。
　では早速いきましょう。以下のコードを書いてみましょう。

###### <font color='red'>多項式回帰をしてみよう</font>

```python
  from sklearn.preprocessing import PolynomialFeatures
   #n=2で試してみます。
   # データの生成方法の指定
   poly_reg = PolynomialFeatures(degree = 2)
   # データをルールに基づいて生成
   X_train_poly = poly_reg.fit_transform(X_train)
   X_test_poly = poly_reg.fit_transform(X_test)

    # 以下全ての
    # X_train を X_train_poly
    # X_test を X_test_poly
    # へ変更
```

以下でコード全体を確認してみましょう。

[コード全体](/answer/24)


　はい、これもこれで終了です。実は、**LinearRegression()モデルは、PolynomialFeaturesと組み合わせることによって**多項式回帰分析を行うことができるモデルなのです。ですので、これだけでできてしまいます。
　また、これは2次の曲線で近似していますが、**degree**の値を3,4,5...と増やしていくと字数を上げることができます。しかしながら、予測モデルに、次数の増えたデータを学習させても過学習（フィットしすぎて）になり予測精度が悪くなる可能性があります。
　では、この2次の結果をみてみましょう。


## 各指標をみてみよう

```python
#単回帰分析のとき
RMSE train data:  6.043506135262846
RMSE test data:  6.807077593213252
MSE train data:  36.52396640695966
MSE test data:  46.336305360025925
R^2 
 Train : 0.571031588576562 
 Test : 0.43095672846187605
# 重回帰分析のとき
RMSE train data:  5.365657134224422
RMSE test data:  6.114172522817781
MSE train data:  28.790276482053443
MSE test data:  37.38310563877995
R^2 
 Train : 0.6618625964841893 
 Test : 0.5409084827186418
#多項式回帰分析のとき
RMSE train data:  4.319658995006362
RMSE test data:  5.30518349005234
MSE train data:  18.659453833139377
MSE test data:  28.14497186312392
R^2 
 Train : 0.7808475624020519 
 Test : 0.6543594328054229
```

　決定係数の値が１に近ずいてきており、多項式回帰分析でより現実世界に近いモデルが作れたと言えます。

### 精度の結果をより詳しくみていこう
　次章からは精度の結果をより深く掘り下げてその意味を考えてみたいと思います。

# まとめ
　scikit-learnでの多項式回帰分析の方法と結果をみました。次回は今まで学習してきた３つのモデルの精度を比較、検討してみましょう。